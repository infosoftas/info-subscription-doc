%%{init: { 'sequence': { 'mirrorActors': false } } }%%
sequenceDiagram
    actor Customer
    participant Merchant
    participant INFO as INFO-Subscription
    participant MPS as Mastercard Payment Services
    participant Bank as Customer's Bank

    Note over Merchant,INFO: Setup
    Merchant->>INFO: Configure BetalingsService Account<br/>(Creditor Number, Creditor Group Number)
    
    Note over INFO,Customer: 1. Invoice Generation
    INFO->>INFO: Generate Debtor Number<br/>for Subscriber
    INFO->>Customer: Send Physical Invoice<br/>(Debtor Number, Creditor Number,<br/>Creditor Group Number)
    
    Note over Customer,Bank: 2. Out-of-Band Registration
    Customer->>Bank: Register Mandate in<br/>Online Banking Solution
    activate Bank
    Bank->>MPS: Submit Mandate Registration
    deactivate Bank
    
    Note over MPS,INFO: 3. Mandate Confirmation
    activate MPS
    MPS->>INFO: Send Mandate File<br/>(via SFTP)
    deactivate MPS
    activate INFO
    INFO->>INFO: Process Mandate File<br/>Create Payment Agreement
    deactivate INFO
    
    Note over INFO,MPS: 4. First Claim Processing
    activate INFO
    INFO->>INFO: Generate Invoice/Claim
    INFO->>MPS: Submit Transaction File<br/>(via SFTP)
    deactivate INFO
    
    activate MPS
    MPS->>Bank: Process Payment on Due Date
    deactivate MPS
    
    activate Bank
    Bank->>Customer: Debit Customer Account
    Bank->>MPS: Confirm Payment
    deactivate Bank
    
    activate MPS
    MPS->>INFO: Payment Confirmation File<br/>(via SFTP)
    deactivate MPS
    
    activate INFO
    INFO->>INFO: Process Payment File<br/>Mark Invoice as Paid
    deactivate INFO
